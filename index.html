<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Frontend Python Code Checker</title>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.25.1/full/pyodide.js"></script>
    <style>
        body { font-family: sans-serif; padding: 2em; max-width: 800px; margin: auto; }
        textarea { width: 100%; height: 200px; margin-bottom: 1em; font-family: monospace; }
        button { padding: 10px 15px; cursor: pointer; }
        pre { background-color: #f4f4f4; padding: 1em; border: 1px solid #ddd; white-space: pre-wrap; }
        #loader { font-weight: bold; }
    </style>
</head>
<body>
    <h1>Python Challenge (Frontend)</h1>
    <p>Write a function called `add_two_numbers(a, b)` that returns their sum.</p>
    
    <textarea id="codeInput" placeholder="Your Python code here..."></textarea>
    <button id="runButton" disabled>Run Code</button>
    
    <h2>Results:</h2>
    <div id="loader">Loading Python runtime... Please wait.</div>
    <pre id="resultsOutput"></pre>

<script>
    const codeInput = document.getElementById('codeInput');
    const runButton = document.getElementById('runButton');
    const resultsOutput = document.getElementById('resultsOutput');
    const loader = document.getElementById('loader');

    // This Python code is structured to return a single string at the end.
    const testCode = `
import sys
from io import StringIO

# Capture any output from the user's function (e.g., print statements)
original_stdout = sys.stdout
sys.stdout = captured_output = StringIO()

final_result_string = ""

try:
    # --- Test Cases ---
    assert 'add_two_numbers' in globals(), "Function 'add_two_numbers' not found."
    
    # Test 1
    assert add_two_numbers(2, 3) == 5, f"Test 1 Failed: Expected 5, got {add_two_numbers(2, 3)}"
    
    # Test 2
    assert add_two_numbers(-1, 1) == 0, f"Test 2 Failed: Expected 0, got {add_two_numbers(-1, 1)}"

    final_result_string = "✅ All tests passed!"

except Exception as e:
    final_result_string = f"❌ A test failed or an error occurred:\\n{e}"

finally:
    # Restore the original stdout
    sys.stdout = original_stdout
    user_prints = captured_output.getvalue()

# This is the final expression that will be returned to JavaScript.
# It combines the test results with any output the user's code printed.
final_result_string + "\\n\\n--- Your Function's Output ---\\n" + user_prints
`;

    async function setupPyodide() {
        // Initialize Pyodide
        let pyodide = await loadPyodide();
        loader.textContent = 'Python runtime loaded! Ready to run code.';
        runButton.disabled = false;
        return pyodide;
    }

    // Start loading Pyodide as soon as the page loads
    const pyodidePromise = setupPyodide();

    runButton.addEventListener('click', async () => {
        const pyodide = await pyodidePromise;
        const userCode = codeInput.value;
        resultsOutput.textContent = 'Running tests...';

        try {
            // Run the user's code to make their function available
            pyodide.runPython(userCode);
            
            // Run the tests and capture the final string that the Python code returns
            const output = pyodide.runPython(testCode);
            
            // THIS IS THE FIX:
            // Explicitly set the textContent to the captured output.
            resultsOutput.textContent = output;

        } catch (error) {
            // This will catch syntax errors in the user's code before the tests run
            resultsOutput.textContent = "An error occurred: \n" + error.toString();
        }
    });
</script>

</body>
</html>
